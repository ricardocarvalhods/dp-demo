<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <link href="tutorial.css" rel="stylesheet">
  <link href="census.css" rel="stylesheet">
  <link href="apartment.css" rel="stylesheet">
  <script src='jquery.min.js'></script>
  <script src='privatize.js'></script>
</head>

<body>
  <header class="uscb-layout-row uscb-header-container">
    <div class="uscb-flex-row-20 uscb-flex-row-md-100
                  uscb-layout-align-center-center uscb-layout-align-md-start-center">
      <div class="uscb-menu-icon-container uscb-hide-gt-md
                    uscb-flex-row-md-20"></div>
      <div class="uscb-flex-row-md-80">
        <a href="https://www.census.gov">
            <img class="uscb-nav-image" src="images/census.svg">
          </a>
      </div>
    </div>
    <div class="uscb-flex-row-80 uscb-layout-align-start-center uscb-hide-md">
      <a href="home.html">
        <h1 class="uscb-h2 uscb-color-white">Disclosure Avoidance</h1>
      </a>
    </div>
  </header>


  <div class="uscv-layout-row uscb-min-height-100vh uscb-layout-align-center-center uscb-layout-align-vert-center">


    <div class="uscb-flex-row-70 uscb-flex-row-md-100 uscb-padding-3em">
      <section>
        <div style="margin-top: 1em; margin-bottom:1em;">
          <div class="uscb-layout-row uscb-layout-align-space-between" style="background-color: rgb(17,46,81); color: rgb(255,255,255);
                                                                                padding: 1em;">
            <p class="uscb-title-1 uscb-margin-TB-02">Privacy Simulator</p>
          </div>
          <div class="   " style="box-shadow: black 0px 8px 6px -6px; border: 1px solid rgb(238, 238, 238); padding: 1em;">

            <p class="uscb-title-2 uscb-margin-BTM-8px uscb-color-primary">Testing Header</p>

            <h3>NEW INTRO WRITTEN</h3>

            <h3>LOREM IMPSUM SIT AMET</h3>

            <hr class="uscb-hr-flex uscb-bg-primary" />

            <table width=100%>
              <tr>
                <th>True Data: </th>
                <th class="metrics">Avg. Age</th>
                <td id="trueAvgAge" class="metrics">0</td>
                <th class="metrics"># Female</th>
                <td id="trueCountF" class="metrics">0</td>
                <th class="metrics"># Male</th>
                <td id="trueCountM" class="metrics">0</td>
                <th class="metrics"></th>
                <td></td>
              </tr>

              <tr>
                <th>Reported Data: </th>
                <th class="metrics">Avg. Age</th>
                <td id="reportedAvgAge" class="metrics" style="background-color: yellow;">0</td>
                <th class="metrics"># Female</th>
                <td id="reportedCountF" class="metrics" style="background-color: yellow;">0</td>
                <th class="metrics"># Male</th>
                <td id="reportedCountM" class="metrics" style="background-color: yellow;">0</td>
                <th class="metrics" style="background-color: lightgreen;">ACCURACY:</th>
                <td id="accuracy">100%
                  <td/>
              </tr>


            </table>

            <div id="illustration" class="uscb-layout-column uscb-layout-align-flex-end" style="height: 375px; background-color: lightblue;">
              <div id="houses" class="uscb-layout-row uscb-layout-align-space-around" style="height: 200px; background-color: lightblue;">
              </div>
              <div id="grass" class="uscb-layout-row uscb-layout-align-space-around" style="height: 100px; background-color: lightgreen;">
              </div>
            </div>

            <div id="sliders" class="uscb-layout-row uscb-layout-align-center uscb-layout-align-vert-center" style="height: 80px;">
              <img id="Lhouse" src="images/Lpeople.png" width=20px alt="person">
              <div width=100px></div>
              <div class="myslider">
                <input id="slider2" type="range" min="1" max="10" value="50" class="slider">
              </div>
              <div width=100px></div>
              <img id="Rhouse" src="images/Rpeople.png" width=60px alt="person">
            </div>

            <div id="epsilonProtect" class="uscb-layout-row uscb-layout-align-space-evenly uscb-layout-align-vert-center" style="height: 50px; font-family: Lora, sans-serif; background-color:lightgreen;">
              <img id="epsilon" src="images/epsilon.png" width=25px alt="epsilon">
              <div class="myslider" width=200px>
                <input id="epsilonSlider" type="range" min="1" max="100" value="50" class="slider" width=100%>
              </div>
              <div id="rollButton" class="uscb-primary-button">PROTECT</div>
            </div>
            <p>AFTERWORD</p>
            <p>Unicode playpen: <span style="font-size: 30pt;">&#x1F64E;&#xFE0F; </span></p>

            <br>
            <a class="uscb-primary-link" style="float:right" href="home.html">Privacy Education Home</a>
            <hr class="uscb-light-teal-hr" />
          </div>

        </div>
      </section>
    </div>
  </div>
  <script>
    apt_residents = [];

    icons = [{
        'html': '3&#x1F64E;&#xFE0F;',
        'men': 0,
        'women': 1,
        'age': 25
      }, //woman
      {
        'html': '&#x1F46B;',
        'men': 1,
        'women': 1,
        'age': 27
      }, //man and woman
      {
        'html': '&#x1F46A;',
        'men': 2,
        'women': 1,
        'age': 30
      }, //family
      {
        'html': '&#x1F481;',
        'men': 0,
        'women': 1,
        'age': 25
      } //woman2
    ]



    // Repeat a string, substituting %i for the counter
    function repeat(s, start, end) {
      ret = []
      for (var i = start; i < end; i++) {
        ret.push(s.replace("%i", i))
      }
      return ret.join("");
    }

    function draw_houses(count) {
      $('#houses').html('<div id="house1" class="house">' + '<div id="apartment" style="padding-top:10pt; font-size:20pt"></div>' + '</div>');
    }

    function draw_windows(count) {
      $('#apartment').html(repeat(
        '<div class="windowHolder" id="wh%i"></div>', 0, 4));
      for (index = 0, i = 0; i < 4; i++) {
        $('#wh' + i).html(repeat('<div class="window" id="w%i"/><div class="windowSpacer" id="wsp%i"/>', index, index + 4))
        index += 4;
      }
    }

    function set_people_count(count) {
      apt_residents = []
      people = Math.round(count / 10 * 16); //fraction of the slider * window number
      for (i = 0; i < 16; i++) {
        html = '';
        if (i < people) {
          person = icons[Math.round(Math.random() * 2)];
          apt_residents.push(person);
          html = person['html'];
        }
        $('#w' + i).html(html);
      }
      update_values()
    }

    function update_values() {
      //update counts using people dictionary
      metrics = {
        'men': 0,
        'women': 0,
        'age': 0
      };
      for (i = 0; i < apt_residents.length; i++) {
        elem = apt_residents[i];
        metrics['men'] += elem['men'];
        metrics['age'] += elem['age'];
        metrics['women'] += elem['women'];
      }
      metrics['age'] /= apt_residents.length;
      metrics['age'] = Math.round(metrics['age'] * 10) / 10;
      //update html elements
      $('#trueAvgAge').html('' + metrics['age']);
      $('#trueCountF').html('' + metrics['women']);
      $('#trueCountM').html('' + metrics['men']);
    }

    // Set the number of people the apartment
    function slider2_moves(event) {
      var slider2 = $('#slider2').val();
      count = slider2;
      set_people_count(count);
    }

    // given the current model, update the accuracy cell in the view.
    function update_accuracy(model) {
      trueVals = [];
      repVals = [];
      for (i = 0; i < 3; i++) {
        trueVals[i] = parseInt($('#true' + model.labels[i]).html());
      }
      for (i = 0; i < 3; i++) {
        repVals[i] = parseInt($('#reported' + model.labels[i]).html());
      }
      accuracy = 0
      for (i = 0; i < trueVals.length; i++) {
        accuracy += Math.abs(trueVals[i] / repVals[i] * 100);
      }
      accuracy /= trueVals.length;
      $('#accuracy').html('' + Math.round(accuracy * 10) / 10 + "%");
    }

    // update is called by the engine after a differential privacy operation is done.
    // We update the screen and recalculate the accuracy
    var update = function(model) {
      console.log("UPDATING with values " + model.noisy_counts);
      var i;
      for (i = 0; i < model.counts.length; i++) {
        $('#reported' + model.labels[i]).html(model.noisy_counts[i]);
      }
      //update_accuracy(model);
    }

    function roll_dp(event) {
      epsilon_slider_value = $('#epsilonSlider').val() / 50;
      console.log("ROLLING with slider " + epsilon_slider_value);
      // Create the differential privacy object
      model = {
        epsilon: epsilon_slider_value,
        callback: update,
        counts: [],
        labels: ['CountM', 'CountF', 'AvgAge'],
        invariant_counts: 1
      };
      // Now get the counts from the HTML form
      var i;
      for (i = 0; i < model.labels.length; i++) {
        model.counts[i] = parseFloat($('#true' + model.labels[i]).html());
      }
      console.log("true values " + model.counts + " CALLING uscb-primary-ul");
      privatize_histogram(model);
    }

    // All wrapped inside the document.ready() function so that it runs when the document is completely loaded
    // We bind the 'input' event because it fires whenever the slider is moved. The 'changed' event only fires
    // when the slider is released
    $(document).ready(function() {
      draw_houses(1);
      draw_windows(4);
      $('#slider2').val(0);
      $('#slider2').on('input', slider2_moves);
      $('#rollButton').on('click', roll_dp);
    });
  </script>
</body>

</html>