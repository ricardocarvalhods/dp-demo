<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <link href="census.css" rel="stylesheet">
  <link href="tutorial.css" rel="stylesheet">
  <link href="apartment.css" rel="stylesheet">
  <script src='jquery.min.js'></script>
  <script src='privatize.js'></script>
</head>

<body>
  <header class="uscb-layout-row uscb-header-container">
    <div class="uscb-flex-row-20 uscb-flex-row-md-100
                  uscb-layout-align-center-center uscb-layout-align-md-start-center">
      <div class="uscb-menu-icon-container uscb-hide-gt-md
                    uscb-flex-row-md-20"></div>
      <div class="uscb-flex-row-md-80">
        <a href="https://www.census.gov">
            <img class="uscb-nav-image" src="images/census.svg">
          </a>
      </div>
    </div>
    <div class="uscb-flex-row-80 uscb-layout-align-start-center uscb-hide-md">
      <h1 class="uscb-h2 uscb-color-white"><a href="index.html">Disclosure Avoidance</a></h1>
    </div>
  </header>

  <div class="uscv-layout-row uscb-min-height-100vh uscb-layout-align-center-center">
    <div class="uscb-flex-row-80 uscb-flex-row-md-100 uscb-padding-3em">

      <div class="   " style="box-shadow: black 0px 8px 6px -6px; border: 1px solid rgb(238, 238, 238); padding: 1em">
        <ul role="menu" class="uscb-tabs uscb-layout-row uscb-layout-align-space-between">
          <li role="none" class="uscb-tab uscb-layout-row uscb-layout-align-center-center">
            <a href="intro.html" role="menuitem" class="uscb-tabs-link">Noise in the Census</a>
          </li>
          <li role="none" class="uscb-tab uscb-layout-row uscb-layout-align-center-center">
            <a href="section1.html" role="menuitem" class="uscb-tabs-link">Noise in a Block</a>
          </li>
          <li role="none" class="uscb-tab uscb-layout-row uscb-layout-align-center-center">
            <a href="section2.html" role="menuitem" class="uscb-tabs-link">Noise and Accuracy</a>
          </li>
          <li role="none" class="uscb-tab uscb-layout-row uscb-layout-align-center-center">
            <a href="section3.html" role="menuitem" class="uscb-tabs-link">Protecting Data Releases</a>
          </li>
          <li role="none" class="uscb-tab uscb-layout-row uscb-layout-align-center-center">
            <a href="section4.html" role="menuitem" class="uscb-tabs-link">Protecting Group Quarters</a>
          </li>
          <li role="none" class="uscb-tab uscb-layout-row uscb-layout-align-center-center">
            <a href="end.html" role="menuitem" class="uscb-tabs-link">Data Privacy in 2020</a>
          </li>

        </ul>
      </div>

      <section>
        <div style="margin-top: 1em; margin-bottom:1em;">
          <div class="uscb-layout-row uscb-layout-align-space-between" style="background-color: rgb(17,46,81); color: rgb(255,255,255);
                                                                                padding: 1em;">
            <p class="uscb-title-1 uscb-margin-TB-02">Noise and Accuracy</p>
          </div>
          <h3>In the last example, we saw how adding noise to data protected the privacy of a family. With noise, we have obscured the familyâ€™s data, but now our results are slightly less accurate. Recall that the noise we add is random, many of the residences have small amounts of noise added, and a few have large amounts of noise added.</h3>

          <br><br>
          <div class="uscb-layout-row uscb-padding-TB-15 uscb-padding-LR-30
      uscb-dark-grey-content-container uscb-layout-align-space-between
      uscb-wrap">
            <h3>To visualize how privacy and accuracy are related, and how noise affects data, play with our <a href="apartment.html">interactive simulator</a>.</h3> </div>

          <br><br>

          <h3>Because of the noise, some blocks will overcount statistics with positive noise, and others will undercount them with negative noise. These undercounts and overcounts are easier to spot at small geographic levels like census blocks, since the reported results can vary slightly.</h3>
          <div class="uscb-layout-row uscb-layout-align-center-center uscb-padding-TB-30">
            <img src="images/cblock.png" alt="House" width="550px">
          </div>
          <h3>But remember, the Census Bureau collects data on the entire country, counting over <strong>300 million people</strong> in over 11 million census blocks.</h3>

          <div class="uscb-layout-row uscb-layout-align-center-center uscb-padding-TB-30">
            <img src="images/city.png" alt="House" width="550px">
          </div>


          <h3>At larger geographic levels like states, often with millions of residents, the undercounts and overcounts balance the noise, and the reported results are not as affected as at the block level. This results in a set of Census 2020 data that is accurate for the needs of data users. </h3>
          <br>

          <a class="uscb-primary-link" style="float:right" href="section3.html">Next Section</a>
          <hr class="uscb-light-teal-hr" />

        </div>

    </div>
    </section>
  </div>
  </div>
  <script>
    apt_residents = [];

    icons = [{
        'html': '&#x1F64E;&#xFE0F;',
        'men': 0,
        'women': 1,
        'age': 25
      }, //woman
      {
        'html': '&#x1F46B;',
        'men': 1,
        'women': 1,
        'age': 27
      }, //man and woman
      {
        'html': '&#x1F46A;',
        'men': 2,
        'women': 1,
        'age': 30
      }, //family
      {
        'html': '&#x1F481;',
        'men': 0,
        'women': 1,
        'age': 25
      } //woman2
    ]



    // Repeat a string, substituting %i for the counter
    function repeat(s, start, end) {
      ret = []
      for (var i = start; i < end; i++) {
        ret.push(s.replace("%i", i))
      }
      return ret.join("");
    }

    function draw_houses(count) {
      $('#houses').html('<div id="house1" class="house">' + '<div id="apartment" style="padding-top:10pt; font-size:20pt"></div>' + '</div>');
    }

    function draw_windows(count) {
      $('#apartment').html(repeat(
        '<div class="windowHolder" id="wh%i"></div>', 0, 4));
      for (index = 0, i = 0; i < 4; i++) {
        $('#wh' + i).html(repeat('<div class="window" id="w%i"/><div class="windowSpacer" id="wsp%i"/>', index, index + 4))
        index += 4;
      }
    }

    function set_people_count(count) {
      apt_residents = []
      people = Math.round(count / 10 * 16); //fraction of the slider * window number
      for (i = 0; i < 16; i++) {
        html = '';
        if (i < people) {
          person = icons[Math.round(Math.random() * 2)];
          apt_residents.push(person);
          html = person['html'];
        }
        $('#w' + i).html(html);
      }
      update_values()
    }

    function update_values() {
      //update counts using people dictionary
      metrics = {
        'men': 0,
        'women': 0,
        'age': 0
      };
      for (i = 0; i < apt_residents.length; i++) {
        elem = apt_residents[i];
        metrics['men'] += elem['men'];
        metrics['age'] += elem['age'];
        metrics['women'] += elem['women'];
      }
      metrics['age'] /= apt_residents.length;
      metrics['age'] = Math.round(metrics['age'] * 10) / 10;
      //update html elements
      $('#trueAvgAge').html('' + metrics['age']);
      $('#trueCountF').html('' + metrics['women']);
      $('#trueCountM').html('' + metrics['men']);
    }

    // Set the number of people the apartment
    function slider2_moves(event) {
      var slider2 = $('#slider2').val();
      count = slider2;
      set_people_count(count);
    }

    // given the current model, update the accuracy cell in the view.
    function update_accuracy(model) {
      trueVals = [];
      repVals = [];
      for (i = 0; i < 3; i++) {
        trueVals[i] = parseInt($('#true' + model.labels[i]).html());
      }
      for (i = 0; i < 3; i++) {
        repVals[i] = parseInt($('#reported' + model.labels[i]).html());
      }
      accuracy = 0
      for (i = 0; i < trueVals.length; i++) {
        accuracy += Math.abs(trueVals[i] / repVals[i] * 100);
      }
      accuracy /= trueVals.length;
      $('#accuracy').html('' + Math.round(accuracy * 10) / 10 + "%");
    }

    // update is called by the engine after a differential privacy operation is done.
    // We update the screen and recalculate the accuracy
    var update = function(model) {
      console.log("UPDATING");
      var i;
      for (i = 0; i < model.counts.length; i++) {
        $('#reported' + model.labels[i]).html(model.noisy_counts[i]);
      }
      //update_accuracy(model);
    }

    function roll_dp(event) {
      epsilon_slider_value = $('#epsilonSlider').html();
      console.log("ROLLING with slider " + epsilon_slider_value);
      // Create the differential privacy object
      model = {
        epsilon: epsilon_slider_value,
        callback: update,
        counts: [],
        labels: ['CountM', 'CountF', 'AvgAge'],
        invariant_counts: 1
      };
      // Now get the counts from the HTML form
      var i;
      for (i = 0; i < model.labels.length; i++) {
        model.counts[i] = parseInt($('#true' + model.labels[i]).html());
      }
      console.log("CALLING PRIVATIZE");
      privatize_histogram(model);
    }

    // All wrapped inside the document.ready() function so that it runs when the document is completely loaded
    // We bind the 'input' event because it fires whenever the slider is moved. The 'changed' event only fires
    // when the slider is released
    $(document).ready(function() {
      draw_houses(1);
      draw_windows(4);
      $('#slider2').val(0);
      $('#slider2').on('input', slider2_moves);
      $('#rollButton').on('click', roll_dp);
    });
  </script>
</body>

</html>
